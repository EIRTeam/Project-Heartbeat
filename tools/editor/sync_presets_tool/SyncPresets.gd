var static_presets = {
	###
	### Ordinary quad
	###
	"Quad": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(240, 240),
			"entry_angle": -135.0,
			"oscillation_frequency": 0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(1680, 240),
			"entry_angle": -45.0,
			"oscillation_frequency": 0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(240, 768),
			"entry_angle": -225.0,
			"oscillation_frequency": 0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1680, 768),
			"entry_angle": 45.0,
			"oscillation_frequency": 0,
			"distance": 880
		}
	},
	###
	### Ordinary inverse quad
	###
	"Quad inverse": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(240, 240),
			"entry_angle": 45.0,
			"oscillation_frequency": 0,
			"distance": 1360
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(1680, 240),
			"entry_angle": -225.0,
			"oscillation_frequency": 0,
			"distance": 1360
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(240, 768),
			"entry_angle": -45.0,
			"oscillation_frequency": 0,
			"distance": 1360
		},	
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1680, 768),
			"entry_angle": -135.0,
			"oscillation_frequency": 0,
			"distance": 1360
		}
	},
	###
	### Small quad
	###
	"Quad small": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(336, 336),
			"entry_angle": -135.0,
			"oscillation_frequency": 0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(1584, 336),
			"entry_angle": -45.0,
			"oscillation_frequency": 0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(336, 672),
			"entry_angle": -225.0,
			"oscillation_frequency": 0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1584, 672),
			"entry_angle": 45.0,
			"oscillation_frequency": 0,
			"distance": 880
		}
	},
	###
	### Small inverse quad
	###
	"Quad small inverse": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(336, 336),
			"entry_angle": 45.0,
			"oscillation_frequency": 0,
			"distance": 1360
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(1584, 336),
			"entry_angle": -225.0,
			"oscillation_frequency": 0,
			"distance": 1360
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(336, 672),
			"entry_angle": -45.0,
			"oscillation_frequency": 0,
			"distance": 1360
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1584, 672),
			"entry_angle": -135.0,
			"oscillation_frequency": 0,
			"distance": 1360
		}
	},
	###
	### Tiny quad
	###
	"Quad tiny": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(432, 432),
			"entry_angle": -135.0,
			"oscillation_frequency": 0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(1488, 432),
			"entry_angle": -45.0,
			"oscillation_frequency": 0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(432, 576),
			"entry_angle": -225.0,
			"oscillation_frequency": 0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1488, 576),
			"entry_angle": 45.0,
			"oscillation_frequency": 0,
			"distance": 880
		}
	},
	###
	### Quad center large
	###
	"Quad center large": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(672, 288),
			"entry_angle": -135.0,
			"oscillation_frequency": 0,
			"distance": 800
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(1248, 288),
			"entry_angle": -45.0,
			"oscillation_frequency": 0,
			"distance": 800
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(672, 768),
			"entry_angle": -225.0,
			"oscillation_frequency": 0,
			"distance": 800
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1248, 768),
			"entry_angle": 45.0,
			"oscillation_frequency": 0,
			"distance": 800
		}
	},
	###
	### Quad center small
	###
	"Quad center small": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(768, 384),
			"entry_angle": -135.0,
			"oscillation_frequency": 0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(1152, 384),
			"entry_angle": -45.0,
			"oscillation_frequency": 0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(768, 672),
			"entry_angle": -225.0,
			"oscillation_frequency": 0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1152, 672),
			"entry_angle": 45.0,
			"oscillation_frequency": 0,
			"distance": 880
		}
	},
	###
	### Quad center small
	###
	"Quad center tiny": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(912, 480),
			"entry_angle": -135.0,
			"oscillation_frequency": 0,
			"distance": 1280
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(1008, 480),
			"entry_angle": -45.0,
			"oscillation_frequency": 0,
			"distance": 1280
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(912, 576),
			"entry_angle": -225.0,
			"oscillation_frequency": 0,
			"distance": 1280
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1008, 576),
			"entry_angle": 45.0,
			"oscillation_frequency": 0,
			"distance": 1280
		}
	},
	###
	### Quad center small
	###
	"Quad center fast": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(912, 480),
			"entry_angle": -135.0,
			"oscillation_frequency": 1.0,
			"oscillation_amplitude": 3000,
			"distance": 2000
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(1008, 480),
			"entry_angle": -45.0,
			"oscillation_frequency": -1.0,
			"oscillation_amplitude": 3000,
			"distance": 2000
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(912, 576),
			"entry_angle": -225.0,
			"oscillation_frequency": -1.0,
			"oscillation_amplitude": 3000,
			"distance": 2000
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1008, 576),
			"entry_angle": 45.0,
			"oscillation_frequency": 1.0,
			"oscillation_amplitude": 3000,
			"distance": 2000
		}
	},
	###
	### Quad sideways
	###
	"Quad sideways": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(960, 336),
			"entry_angle": -90.0,
			"oscillation_frequency": 0.0,
			"distance": 960
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(744, 552),
			"entry_angle": -180.0,
			"oscillation_frequency": 0.0,
			"distance": 960
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(970, 768),
			"entry_angle": 90.0,
			"oscillation_frequency": 0.0,
			"distance": 960
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1176, 552),
			"entry_angle": 0.0,
			"oscillation_frequency": 0.0,
			"distance": 960
		}
	},
	###
	### Quad sideways large
	###
	"Quad sideways large": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(960, 192),
			"entry_angle": -90.0,
			"oscillation_frequency": 0.0,
			"distance": 800
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(384, 528),
			"entry_angle": -180.0,
			"oscillation_frequency": 0.0,
			"distance": 800
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(960, 864),
			"entry_angle": 90.0,
			"oscillation_frequency": 0.0,
			"distance": 800
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1536, 528),
			"entry_angle": 0.0,
			"oscillation_frequency": 0.0,
			"distance": 800
		}
	},
	###
	### Quad sideways tiny
	###
	"Quad sideways tiny": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(960, 432),
			"entry_angle": -90.0,
			"oscillation_frequency": 0.0,
			"distance": 1040
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(864, 528),
			"entry_angle": -180.0,
			"oscillation_frequency": 0.0,
			"distance": 1040
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(960, 624),
			"entry_angle": 90.0,
			"oscillation_frequency": 0.0,
			"distance": 1040
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1056, 528),
			"entry_angle": 0.0,
			"oscillation_frequency": 0.0,
			"distance": 1040
		}
	},
	###
	### Quad part 1
	###
	"Quad part 1": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(960, 432),
			"entry_angle": -45.0,
			"oscillation_frequency": -2.0,
			"oscillation_amplitude": 1000,
			"distance": 1040
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(864, 528),
			"entry_angle": -135.0,
			"oscillation_frequency": -2.0,
			"oscillation_amplitude": 1000,
			"distance": 1040
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(960, 624),
			"entry_angle": -225.0,
			"oscillation_frequency": -2.0,
			"oscillation_amplitude": 1000,
			"distance": 1040
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1056, 528),
			"entry_angle": 45.0,
			"oscillation_frequency": -2.0,
			"oscillation_amplitude": 1000,
			"distance": 1040
		}
	},
	###
	### Quad part 2
	###
	"Quad part 2": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(960, 336),
			"entry_angle": 0.0,
			"oscillation_frequency": -2.0,
			"oscillation_amplitude": 1000,
			"distance": 1040
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(768, 528),
			"entry_angle": -90.0,
			"oscillation_frequency": -2.0,
			"oscillation_amplitude": 1000,
			"distance": 1040
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(960, 720),
			"entry_angle": -180.0,
			"oscillation_frequency": -2.0,
			"oscillation_amplitude": 1000,
			"distance": 1040
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1152, 528),
			"entry_angle": 90.0,
			"oscillation_frequency": -2.0,
			"oscillation_amplitude": 1000,
			"distance": 1040
		}
	},
	###
	### Quad part 3
	###
	"Quad part 3": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(960, 168),
			"entry_angle": 75.0,
			"oscillation_frequency": -2.0,
			"oscillation_amplitude": 1000,
			"distance": 2080
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(600, 528),
			"entry_angle": -15.0,
			"oscillation_frequency": -2.0,
			"oscillation_amplitude": 1000,
			"distance": 2080
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(960, 888),
			"entry_angle": -105.0,
			"oscillation_frequency": -2.0,
			"oscillation_amplitude": 1000,
			"distance": 2080
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1320, 528),
			"entry_angle": -195,
			"oscillation_frequency": -2.0,
			"oscillation_amplitude": 1000,
			"distance": 2080
		}
	},
	###
	### Parallelogram
	###
	"Parallelogram": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(240, 240),
			"entry_angle": -180.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(720, 768),
			"entry_angle": -180.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(1200, 240),
			"entry_angle": -0.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1680, 768),
			"entry_angle": -0.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		}
	},
	###
	### Quad base
	###
	"Quad base": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(240, 768),
			"entry_angle": -120.0,
			"oscillation_frequency": 0.0,
			"distance": 974
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(720, 768),
			"entry_angle": -100.0,
			"oscillation_frequency": 0.0,
			"distance": 974
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(1200, 768),
			"entry_angle": -80.0,
			"oscillation_frequency": 0.0,
			"distance": 974
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1680, 768),
			"entry_angle": -70.0,
			"oscillation_frequency": 0.0,
			"distance": 974
		}
	},
}

var dual_presets = {
	###
	### Triangle left
	###
	"Triangle left": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(240, 816),
			"entry_angle": -225.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(720, 240),
			"entry_angle": -90.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(1200, 816),
			"entry_angle": 45.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		}
	},
	###
	### Triangle right
	###
	"Triangle right": {
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(720, 816),
			"entry_angle": -225.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(1200, 240),
			"entry_angle": -90.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1680, 816),
			"entry_angle": 45.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		}
	},
	###
	### Triangle left inverted	
	###
	"Triangle left inverted": {
		HBNoteData.NOTE_TYPE.UP: {
			"position": Vector2(240, 240),
			"entry_angle": -135.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(720, 816),
			"entry_angle": 90.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(1200, 240),
			"entry_angle": -45.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		}
	},
	###
	### Triangle right inverted
	###
	"Triangle right inverted": {
		HBNoteData.NOTE_TYPE.LEFT: {
			"position": Vector2(720, 240),
			"entry_angle": -135.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.DOWN: {
			"position": Vector2(1200, 816),
			"entry_angle": 90.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		},
		HBNoteData.NOTE_TYPE.RIGHT: {
			"position": Vector2(1680, 240),
			"entry_angle": -45.0,
			"oscillation_frequency": 0.0,
			"distance": 880
		}
	},
}

var dynamic_presets = {
	"Vertical multi left" : VerticalMultiPreset.new(-1),
	"Vertical multi right" : VerticalMultiPreset.new(1),
	"Horizontal multi top" : HorizontalMultiPreset.new(1),
	"Horizontal multi bottom" : HorizontalMultiPreset.new(-1),
	"Slider multi top" : SliderMultiPreset.new(1, false),
	"Slider multi bottom" : SliderMultiPreset.new(-1, false),
	"Inner slider multi top" : SliderMultiPreset.new(1, true),
	"Inner slider multi bottom" : SliderMultiPreset.new(-1, true)
}


class MultiPresetTemplate:
	extends EditorTransformation
	
	var direction = 1
	var editor: HBEditor
	
	func _init(dir):
		direction = dir
	
	func get_notes_at_time(t: int):
		var points = editor.get_notes_at_time(t)
		var result = []
		
		for point in points:
			if point is HBBaseNote:
				result.append(point)
		
		return result
	
	static func sort_by_note_type(a, b):
		return a.note_type < b.note_type
	
	func check_note_is_valid(n):
		pass
	
	func process_type(n, notes):
		pass
	
	func process_position(n, type, notes):
		var pos = n.position as Vector2
		pos.x = 240 + 480 * type
		
		return pos
	
	func modify_angle(a):
		if direction == 1:
			return -a
		else:
			return a
	
	func process_angle(n, type, notes_at_time):
		var angle: float
			
		if notes_at_time.size() == 2:
			var index = notes_at_time.find(n)
			
			angle = 110.0 if index == 0 else 70.0
		else:
			angle = 110.0 if type < 2 else 70.0
		
		return angle
	
	func transform_notes(notes: Array):
		var transformation_result = {}
		
		notes.sort_custom(self, "sort_by_note_type")
		
		for n in notes:
			if not check_note_is_valid(n):
				continue
			
			var notes_at_time = get_notes_at_time(n.time)
			notes_at_time.sort_custom(self, "sort_by_note_type")
			
			if notes_at_time.size() == 1:
				continue
			
			var type = process_type(n, notes)
			
			var pos = process_position(n, type, notes)
			
			var angle = process_angle(n, type, notes_at_time)
			
			angle = modify_angle(angle)
			
			transformation_result[n] = {
				"position": pos,
				"entry_angle": angle,
				"oscillation_frequency": 0.0,
				"distance": 880
			}
		
		return transformation_result


class VerticalMultiPreset:
	extends MultiPresetTemplate
	
	var note_map = [HBNoteData.NOTE_TYPE.UP, HBNoteData.NOTE_TYPE.LEFT, HBNoteData.NOTE_TYPE.DOWN, HBNoteData.NOTE_TYPE.RIGHT]
	
	func _init(dir).(dir):
		pass
	
	func check_note_is_valid(n):
		return n.note_type in note_map
	
	func process_type(n, notes):
		var pos = Vector2(n.position.x, notes[0].position.y)
		var relative_type = n.note_type - notes[0].note_type
		
		return relative_type
	
	func process_position(n, type, notes):
		var pos = Vector2(n.position.x, notes[0].position.y)
		pos.y += 96 * type
		
		return pos
	
	func process_angle(n, type, notes_at_time):
		var angle: float
			
		if notes_at_time.size() == 2:
			var index = notes_at_time.find(n)
			
			angle = -45.0 if index == 0 else 45.0
		else:
			angle = -45.0 if type < 2 else 45.0
		
		return angle
	
	func modify_angle(a):
		if self.direction == -1:
			a = fmod((-a + 180.0), 360.0)
		
		return a


class HorizontalMultiPreset:
	extends MultiPresetTemplate
	
	var note_map = [HBNoteData.NOTE_TYPE.UP, HBNoteData.NOTE_TYPE.LEFT, HBNoteData.NOTE_TYPE.DOWN, HBNoteData.NOTE_TYPE.RIGHT]
	
	func _init(dir).(dir):
		pass
	
	func check_note_is_valid(n):
		return n.note_type in note_map
	
	func process_type(n, notes):
		return note_map.find(n.note_type)


class SliderMultiPreset:
	extends MultiPresetTemplate
	
	# Dont ask
	var note_map_normal = [0, 1, 3, 2]
	var note_map_inner = [3, 2, 0, 1]
	var note_map
	var inner = 0
	
	func _init(dir, inr).(dir):
		inner = inr
		note_map = note_map_inner if inner else note_map_normal
	
	func check_note_is_valid(n):
		return n.is_slide_note()
	
	func process_type(n, notes):
		var point
		for p in editor.selected:
			if p.data == n:
				point = p
				break
		
		var layer = 1 if "2" in point._layer.layer_name else 0
		
		var type = (n.note_type - 4) * 2
		type += layer
		
		var index = note_map.find(type)
		
		return index
	
	func process_angle(n, type, notes_at_time):
		return 110.0 if type < 2 else 70.0
	
	func modify_angle(a):
		if direction == 1:
			a = -a
		
		if inner:
			return a
		else:
			return fmod((-a + 180), 360)
